<% status_text = params[:status].present? ? params[:status].capitalize : 'All' %>
<% content_for :title, "#{status_text} Orders | Dinner Dash" %>

<div class="p-4 min-h-screen">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-xl sm:text-2xl font-bold bruno">Orders</h1>

    <%= form_with url: admin_orders_path, method: :get, class: "flex items-center gap-4" do %>
      <%=
        select_tag :status,
                   options_for_select([['All', '']] + @statuses.map { |s| [s.titleize, s] }, params[:status]),
                   class: 'border-gray-300 rounded-lg px-3 py-2 bg-white text-gray-700 focus:outline-none focus:ring-1 focus:ring-blue-500'
      %>
      <%= submit_tag 'Filter', class: 'bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition cursor-pointer' %>
    <% end %>
  </div>

  <div class="bg-white rounded-xl overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-gray-500 text-sm font-medium">#ID</th>
          <th class="px-6 py-3 text-left text-gray-500 text-sm font-medium">Customer</th>
          <th class="px-6 py-3 text-left text-gray-500 text-sm font-medium">Email</th>
          <th class="px-6 py-3 text-left text-gray-500 text-sm font-medium">Status</th>
          <th class="px-6 py-3 text-left text-gray-500 text-sm font-medium">Total</th>
          <th class="px-6 py-3 text-left text-gray-500 text-sm font-medium">Created</th>
          <th class="px-6 py-3 text-left text-gray-500 text-sm font-medium">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% if @orders.any? %>
          <% @orders.each do |order| %>
            <tr>
              <td class="px-6 py-3"><%= order.id %></td>
              <td class="px-6 py-3"><%= "#{order.first_name} #{order.last_name}" %></td>
              <td class="px-6 py-3"><%= order.email %></td>
              <td class="px-6 py-3 text-[0.8rem]">
                <span
                  class="font-semibold
          <%= order.ordered? ? 'text-yellow-800' : '' %>
          <%= order.paid? ? 'text-green-800' : '' %>
          <%= order.completed? ? 'text-blue-800' : '' %>
          <%= order.cancelled? ? 'text-red-800' : '' %>"
                >
                  <%= order.status.capitalize %>
                </span>
              </td>
              <td class="px-6 py-3">$<%= number_to_currency(order.total_amount, unit: '') %></td>
              <td class="px-6 py-3"><%= order.created_at.strftime('%Y-%m-%d') %></td>
              <td class="px-6 pt-6 flex gap-3 text-[0.7rem]">
                <%= link_to 'View', admin_order_path(order), class: 'text-blue-600 hover:text-blue-800' %>

                <% if order.ordered? %>
                  <%= link_to 'Paid', mark_paid_admin_order_path(order), data: { turbo_method: :patch, turbo_confirm: 'Are you sure?' }, class: 'text-green-700 hover:text-green-900' %>

                  <%= link_to 'Cancel', cancel_admin_order_path(order), data: { turbo_method: :patch, turbo_confirm: 'Are you sure?' }, class: 'text-red-700 hover:text-red-900' %>
                <% end %>

                <% if order.paid? %>
                  <%= link_to 'Completed', complete_admin_order_path(order), data: { turbo_method: :patch, turbo_confirm: 'Are you sure?' }, class: 'text-blue-700 hover:text-blue-900' %>

                  <%= link_to 'Cancel', cancel_admin_order_path(order), data: { turbo_method: :patch, turbo_confirm: 'Are you sure?' }, class: 'text-red-700 hover:text-red-900' %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="7" class="px-6 text-center text-gray-500">
              <%= render 'shared/fallback', text: 'No Orders found' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <% if @orders.any? %>
      <div class="w-full flex justify-center mt-8 text-sm">
        <%= paginate @orders %>
      </div>
    <% end %>
  </div>
</div>
